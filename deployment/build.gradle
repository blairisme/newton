/*
 * MIT License (c)
 *
 * This work is licensed under the MIT License. To view a copy of this
 * license, visit
 *
 *      https://opensource.org/licenses/MIT
 *
 * Author: Blair Butterworth
 */

task updateMasterWar(type: Copy, dependsOn: ':application:master:war') {
  from project(':application:master').collect{it.tasks.withType(War)}
  into project.file('master/libs')
  rename '(.*)-(.*).war', '$1.war'
}

task updateSlaveJar(type: Copy, dependsOn: ':application:slave:assemble') {
  from project(':application:slave').collect{it.tasks.withType(Jar)}
  into project.file('slave/libs')
  rename '(.*)-(.*).jar', '$1.jar'
}

task systemStart(type: Exec, dependsOn: [updateMasterWar, updateSlaveJar]) {
  commandLine 'docker-compose', 'up', '--build'
}

task systemStartDaemon(type: Exec, dependsOn: [updateMasterWar, updateSlaveJar]) {
  commandLine 'docker-compose', 'up', '-d', '--build'
}

task systemStopDaemon(type: Exec) {
  commandLine 'docker-compose', 'stop'
}
